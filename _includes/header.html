<header class="site-header">
  <nav class="navbar navbar-expand-sm">
    <div class="container-fluid header d-flex align-items-center">
      {%- assign default_paths = site.pages | map: "path" -%}
      {%- assign page_paths = site.header_pages | default: default_paths -%}
      <a class="site-title" rel="author" href="/{% if site.lang != site.default_lang %}{{ site.lang }}/{% endif %}">{{
        site.title | escape }}</a>

      {%- if page_paths -%}
      <style>
        .navbar-nav .nav-item.active .nav-link {
          color: var(--link-color) !important;
          border-bottom: 2px solid var(--link-color);
        }

        .dropdown-menu .dropdown-item {
          padding-top: 0.8rem;
          padding-bottom: 0.8rem;
        }
      </style>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ms-auto d-flex align-items-center">
          {% for page_loop in site.pages %}
          {% if page_loop.title %}
          {% assign is_active = false %}

          {% assign lang_page_url = page_loop.url %}
          {% if site.lang != site.default_lang %}
          {% assign lang_page_url = "/" | append: site.lang | append: page_loop.url | replace: '//', '/' %}
          {% endif %}

          {% if page.url == page_loop.url %}
          {% assign is_active = true %}
          {% elsif page_loop.url == '/blog/' and page.url contains '/blog/' %}
          {% assign is_active = true %}
          {% endif %}
          <li class="nav-item {% if is_active %}active{% endif %}">
            {% assign t_key = "menu." | append: page_loop.title | downcase %}
            <a class="nav-link" href="{{ site.baseurl_root }}{{ lang_page_url }}">{% t t_key %}</a>
          </li>
          {% endif %}
          {% endfor %}
        </ul>
      </div>
      {%- endif -%}

      <div class="d-flex align-items-center ms-auto ms-sm-2">
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle Theme">
          <svg class="sun-icon" viewBox="0 0 24 24">
            <path
              d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0s-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0s-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41s-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41s-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z" />
          </svg>
          <svg class="moon-icon" viewBox="0 0 24 24">
            <path
              d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z" />
          </svg>
        </button>
      </div>

      {%- if page_paths -%}
      <button class="navbar-toggler ms-2" type="button" data-bs-toggle="collapse"
        data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      {%- endif -%}

      <!-- Language Selector Dropdown -->
      <div class="d-block btn-group ms-3 text-end">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="languageDropdown"
          data-bs-toggle="dropdown" aria-expanded="false">
          {{ site.language_names[site.lang] | default: site.lang | capitalize }}
        </button>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
          {% for lang in site.languages %}
          {% unless site.lang == lang %}
          <li>
            {% assign clean_url = page.url %}
            {% assign unlocalized_baseurl = site.baseurl_root %}

            {% if site.lang != site.default_lang %}
            {% assign lang_prefix = "/" | append: site.lang | append: "/" %}
            {% assign lang_prefix_no_trailing = "/" | append: site.lang %}

            {% if clean_url == lang_prefix_no_trailing %}
            {% assign clean_url = "/" %}
            {% else %}
            {% assign clean_url = clean_url | replace_first: lang_prefix, "/" %}
            {% endif %}

            {% assign unlocalized_baseurl = site.baseurl_root | replace_first: lang_prefix_no_trailing, "" %}
            {% endif %}

            {% if lang == site.default_lang %}
            <a class="dropdown-item" href="/{{ clean_url | remove_first: '/' | replace: '//', '/' }}">
              {{ site.language_names[lang] }}
            </a>
            {% else %}
            <a class="dropdown-item" href="/{{ lang }}/{{ clean_url | remove_first: '/' | replace: '//', '/' }}">
              {{ site.language_names[lang] }}
            </a>
            {% endif %}
          </li>
          {% endunless %}
          {% endfor %}
        </ul>
      </div>
      <!-- End Language Selector -->

    </div>
    </div>

  </nav>
</header>